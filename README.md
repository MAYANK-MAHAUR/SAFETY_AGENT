
# üõ°Ô∏è Guardian Sentinel Agent

## Overview

The **Guardian Sentinel** is a specialized, multi-stage cybersecurity agent developed on the Sentient Agent Framework. It acts as the primary defense layer, analyzing potential threats (URLs and files) directly within the chat interface, and providing expert security advice.

The agent uses a highly robust architecture that combines **LLM-driven intent classification** with external **VirusTotal** threat intelligence.

**Repository:** [https://github.com/MAYANK-MAHAUR/SAFETY\_AGENT.git](https://github.com/MAYANK-MAHAUR/SAFETY_AGENT.git)

-----

## ‚öôÔ∏è Architectural Deep Dive (Phase 1)

The agent's stability and security are rooted in the multi-stage, modular design of its core components:

### 1\. Request Orchestration (`safety_agent.py`)

This is the control center, coordinating the flow and ensuring input integrity.

  * **Input Handling:** Securely extracts the user's `prompt` and any attached **`file_ids`** (ULIDs).
  * **Robustness:** Includes critical filtering logic to eliminate potential `None` values, preventing common runtime errors when inputs are missing.

### 2\. Core Scanning Logic (`vt_scan.py`)

The execution module for threat analysis.

  * **File ID $\rightarrow$ Content Solution (CRITICAL):** This mechanism resolves the challenge of scanning attachments. It uses the authorized **`session`** object to call the framework's service: `session.get_file_content(file_id)`. This retrieves the actual file content, which is saved to a temporary local file for VirusTotal scanning.
  * **Security:** Temporary files are **immediately deleted** after analysis to ensure data privacy and system hygiene.

### 3\. Output & Assessment

  * **LLM-Driven Risk Score:** The final risk score is generated by combining the raw VirusTotal data with a secondary, contextual analysis performed by the LLM, leading to a more informed verdict.
  * **API Stability (`llm.py`):** Includes robust `try...except` blocks to prevent the agent from crashing due to external API failures or network timeouts.

-----

## üß™ Postman Testing Guide

You can test the agent's core intent classification and URL scanning capability by posting to your agent's running URL.

### Request Details

| Field | Value |
| :--- | :--- |
| **Method** | `POST` |
| **URL** | `http://127.0.0.1:8000/assist` (or your deployment URL) |
| **Content-Type** | `application/json` |

### JSON Request Body

This test case specifically challenges the agent to classify the intent as **`scan`** and extract a URL.

```json
{
    "session": {
        "processor_id": "sentient-chat-client",
        "activity_id": "01K6BEMNWZFMP3RMGJTFZBND2N",
        "request_id": "01K6BEPKY12FMR1S19Y3SE01C6",
        "interactions": []
    },
    "query": {
        "id": "01K6BEMZ2QZQ58ADNDCKBPKD51",
        "prompt": "is this safe? hianime.to",
        "context": ""
    }
}
```

### Expected Output

1.  **Intent Classified:** **`scan`** (Target Type: **`url`**)
2.  **Execution:** The agent will select one URL to scan (as currently designed) and calculate the final risk score.
3.  **Result:** The agent streams back blocks containing the **Risk Score**, the **Verdict**, and the final **Security Advice**.

-----

## üó∫Ô∏è Roadmap: Phase 2 Enhancements

Phase 2 will focus on expanding the agent's scope, intelligence, and performance by introducing parallel processing and multi-source data fusion.

| Feature | Goal | Technical Action |
| :--- | :--- | :--- |
| **Multi-URL Scanning** | Allow the agent to process lists of URLs in a single request. | Modify `query_processor` to return a list of URLs, and update scanning logic to iterate over them. |
| **Multi-API Integration** | Fuse data from services beyond VirusTotal (e.g., Domain reputation services, IP WHOIS). | Integrate new API clients into `vt_scan.py` and update the scoring algorithm for data fusion. |
| **Parallel Execution** | Dramatically reduce latency when scanning multiple targets or querying multiple APIs. | Implement Python's `asyncio` or `threading/multiprocessing` to run simultaneous network requests (e.g., scan 5 URLs concurrently). |
| **Conclusion/Verdict Engine** | Create a final module that takes conflicting results from multiple APIs and provides a definitive, final verdict based on weighted evidence. | Develop a scoring engine (e.g., Bayes theorem) that intelligently combines all parallel data for the final risk assessment. |
| **Persistence & DB** | Replace the current in-memory `scan_results` with a simple database (e.g., SQLite) for permanent history storage. | Update `memory.py` functions to use a database for persistent logging. |
| **More Detailed Analysis** |



## Agent Streaming Output

The agent will send the response in three distinct, sequential events:

### 1\. Status Event

This event confirms the classification of your query and the command the agent is executing.

  * **`event_name`**: `agent_status`
  * **Content**:
    ```markdown
    **Processing Command:** SCAN
    ```

### 2\. Scan Result Event

This event reports the final numerical result determined by combining the VirusTotal score and the LLM's initial analysis.

  * **`event_name`**: `scan_result`
  * **Content**: (Based on your final result of 15% Risk, Verdict: Malicious)
    ```markdown
    **URL Scan Completed:** Risk 15%, Verdict: Malicious
    ```

### 3\. Security Advice Event

This final event contains the detailed, human-readable advice generated by the LLM (`generate_advice`) based on the verdict above.

  * **`event_name`**: `scan_advice`
  * **Content**:
    ```markdown
    **Security Advice:**
    The URL "hianime.to" has been flagged with a 15% risk score and classified as malicious, indicating potential threats such as phishing, malware distribution, or fraudulent activity. Previous scans of similar URLs suggest a pattern of suspicious behavior, raising concerns about its legitimacy. Users should avoid visiting this site to prevent exposure to security risks. It is advisable to block the domain at the network level and educate users about recognizing unsafe links. Always verify the authenticity of websites before entering any personal information.
    ```


